<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Backward Incompatible Changes</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="migration81.constants.html">« New Global Constants</a></li>
      <li style="float: right;"><a href="migration81.deprecated.html">Deprecated Features »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="migration81.html">Migrating from PHP 8.0.x to PHP 8.1.x</a></li>
    <li>Backward Incompatible Changes</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="migration81.incompatible" class="sect1">
 <h2 class="title">Backward Incompatible Changes</h2>

 <div class="sect2" id="migration81.incompatible.core">
  <h3 class="title">PHP Core</h3>

  <div class="sect3" id="migration81.incompatible.core.globals-access">
   <h4 class="title">$GLOBALS Access Restrictions</h4>

   <p class="para">
    Access to the <var class="varname"><a href="reserved.variables.globals.html" class="classname">$GLOBALS</a></var> array is now subject to
    a number of restrictions.
    Read and write access to individual array elements like
    <code class="code">$GLOBALS[&#039;var&#039;]</code> continues to work as-is.
    Read-only access to the entire <var class="varname"><a href="reserved.variables.globals.html" class="classname">$GLOBALS</a></var> array also
    continues to be supported.
    However, write access to the entire <var class="varname"><a href="reserved.variables.globals.html" class="classname">$GLOBALS</a></var> array
    is no longer supported. For example, <code class="code">array_pop($GLOBALS)</code>
    will result in an error.
   </p>
  </div>

  <div class="sect3" id="migration81.incompatible.core.static-variable-inheritance">
   <h4 class="title">
    Usage of <span class="modifier">static</span> Variables in Inherited Methods
   </h4>

   <p class="para">
    When a method using static variables is inherited (but not overridden), the
    inherited method will now share static variables with the parent method.
    <div class="informalexample">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">A&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">counter</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;</span><span style="color: #0000BB">$counter&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$counter</span><span style="color: #007700">++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$counter</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br />class&nbsp;</span><span style="color: #0000BB">B&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">A&nbsp;</span><span style="color: #007700">{}<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">A</span><span style="color: #007700">::</span><span style="color: #0000BB">counter</span><span style="color: #007700">());&nbsp;</span><span style="color: #FF8000">//&nbsp;int(1)<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">A</span><span style="color: #007700">::</span><span style="color: #0000BB">counter</span><span style="color: #007700">());&nbsp;</span><span style="color: #FF8000">//&nbsp;int(2)<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">B</span><span style="color: #007700">::</span><span style="color: #0000BB">counter</span><span style="color: #007700">());&nbsp;</span><span style="color: #FF8000">//&nbsp;int(3),&nbsp;previously&nbsp;int(1)<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">B</span><span style="color: #007700">::</span><span style="color: #0000BB">counter</span><span style="color: #007700">());&nbsp;</span><span style="color: #FF8000">//&nbsp;int(4),&nbsp;previously&nbsp;int(2)<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>

    This means that static variables in methods now behave the same way as
    static properties.
   </p>
  </div>

  <div class="sect3" id="migration81.incompatible.core.type-compatibility-internal">
   <h4 class="title">Return Type Compatibility with Internal Classes</h4>

   <p class="para">
    Most non-final internal methods now require overriding methods to declare
    a compatible return type, otherwise a deprecated notice is emitted during
    inheritance validation.
    In case the return type cannot be declared for an overriding method due to
    PHP cross-version compatibility concerns,
    a <code class="code">#[ReturnTypeWillChange]</code> attribute can be added to silence
    the deprecation notice.
   </p>
  </div>

  <div class="sect3" id="migration81.incompatible.core.new-keywords">
   <h4 class="title">New Keywords</h4>
   <p class="para">
    <code class="literal">readonly</code> is a keyword now. However, it still may be used
    as function name.
   </p>
  </div>
 </div>

 <div class="sect2" id="migration81.incompatible.resource2object">
  <h3 class="title">Resource to Object Migration</h3>

  <p class="para">
   Several <a href="language.types.resource.html" class="link">resource</a>s have been migrated to <span class="type">object</span>s.
   Return value checks using <span class="function"><a href="function.is-resource.html" class="function">is_resource()</a></span> should be replaced with checks for <strong><code>false</code></strong>.
  </p>
  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     The <a href="book.fileinfo.html" class="link">FileInfo</a> functions now accept and return
     <span class="classname"><a href="class.finfo.html" class="classname">finfo</a></span> objects instead of
     <code class="literal">fileinfo</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <a href="book.ftp.html" class="link">FTP</a> functions now accept and return
     <span class="classname"><a href="class.ftp-connection.html" class="classname">FTP\Connection</a></span> objects instead of
     <code class="literal">ftp</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <a href="book.imap.html" class="link">IMAP</a> functions now accept and return
     <span class="classname"><a href="class.imap-connection.html" class="classname">IMAP\Connection</a></span> objects instead of
     <code class="literal">imap</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <a href="book.ldap.html" class="link">LDAP</a> functions now accept and return
     <span class="classname"><a href="class.ldap-connection.html" class="classname">LDAP\Connection</a></span> objects instead of
     <code class="literal">ldap link</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <a href="book.ldap.html" class="link">LDAP</a> functions now accept and return
     <span class="classname"><a href="class.ldap-result.html" class="classname">LDAP\Result</a></span> objects instead of
     <code class="literal">ldap result</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <a href="book.ldap.html" class="link">LDAP</a> functions now accept and return
     <span class="classname"><a href="class.ldap-result-entry.html" class="classname">LDAP\ResultEntry</a></span> objects instead of
     <code class="literal">ldap result entry</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <a href="book.pgsql.html" class="link">PgSQL</a> functions now accept and return
     <span class="classname"><a href="class.pgsql-connection.html" class="classname">PgSql\Connection</a></span> objects instead of
     <code class="literal">pgsql link</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <a href="book.pgsql.html" class="link">PgSQL</a> functions now accept and return
     <span class="classname"><a href="class.pgsql-result.html" class="classname">PgSql\Result</a></span> objects instead of
     <code class="literal">pgsql result</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <a href="book.pgsql.html" class="link">PgSQL</a> functions now accept and return
     <span class="classname"><a href="class.pgsql-lob.html" class="classname">PgSql\Lob</a></span> objects instead of
     <code class="literal">pgsql large object</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <a href="book.pspell.html" class="link">PSpell</a> functions now accept and return
     <span class="classname"><a href="class.pspell-dictionary.html" class="classname">PSpell\Dictionary</a></span> objects instead of
     <code class="literal">pspell</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <a href="book.pspell.html" class="link">PSpell</a> functions now accept and return
     <span class="classname"><a href="class.pspell-config.html" class="classname">PSpell\Config</a></span> objects instead of
     <code class="literal">pspell config</code> <a href="language.types.resource.html" class="link">resource</a>s.
    </p>
   </li>
  </ul>
 </div>

 <div class="sect2" id="migration81.incompatible.mysqli">
  <h3 class="title">MySQLi</h3>

  <p class="para">
   <span class="function"><a href="mysqli-result.fetch-fields.html" class="function">mysqli_fetch_fields()</a></span>, and
   <span class="function"><a href="mysqli-result.fetch-field-direct.html" class="function">mysqli_fetch_field_direct()</a></span> will now always return
   <code class="literal">0</code> for the <span class="property">max_length</span>.
   This information can be computed by iterating over the result set,
   and taking the maximum length. This is what PHP was doing
   internally previously.
  </p>

  <p class="para">
   The <strong><code>MYSQLI_STMT_ATTR_UPDATE_MAX_LENGTH</code></strong>
   option no longer has any effect.
  </p>

  <p class="para">
   The <strong><code>MYSQLI_STORE_RESULT_COPY_DATA</code></strong>
   option no longer has any effect. Passing any value to the
   <code class="parameter">mode</code> parameter of
   <span class="methodname"><a href="mysqli.store-result.html" class="methodname">mysqli::store_result()</a></span> no longer has any effect.
  </p>

  <p class="para">
   <span class="methodname"><a href="function.mysqli-connect.html" class="methodname">mysqli::connect()</a></span> now returns <strong><code>true</code></strong> instead of <strong><code>null</code></strong> on success.
  </p>

  <p class="para">
   The default error handling mode has been changed from &quot;silent&quot; to &quot;exceptions&quot;
   See the <a href="mysqli-driver.report-mode.html" class="link">MySQLi reporting mode</a>
   page for more details on what this entails,
   and how to explicitly set this attribute.
   To restore the previous behaviour use:
   <code class="code">mysqli_report(MYSQLI_REPORT_OFF);</code>
  </p>

  <p class="para">
   Classes extending <span class="methodname"><a href="mysqli-stmt.execute.html" class="methodname">mysqli_stmt::execute()</a></span>
   are now required to specify the additional mandatory parameter.
  </p>
 </div>

 <div class="sect2" id="migration81.incompatible.mysqlnd">
  <h3 class="title">MySQLnd</h3>

  <p class="para">
   The <a href="mysqlnd.config.html#ini.mysqlnd.fetch_data_copy" class="link">mysqlnd.fetch_data_copy</a>
   INI directive has been removed.
   This should not result in user-visible behavior changes.
  </p>
 </div>

 <div class="sect2" id="migration81.incompatible.openssl">
  <h3 class="title">OpenSSL</h3>

  <p class="para">
   EC private keys will now be exported in PKCS#8 format rather than
   traditional format, just like all other keys.
  </p>
  <p class="para">
   <span class="function"><a href="function.openssl-pkcs7-encrypt.html" class="function">openssl_pkcs7_encrypt()</a></span> and
   <span class="function"><a href="function.openssl-cms-encrypt.html" class="function">openssl_cms_encrypt()</a></span> will now to default using
   AES-128-CBC rather than RC2-40. The RC2-40 cipher is considered
   insecure and not enabled by default by OpenSSL 3.
  </p>
 </div>

 <div class="sect2" id="migration81.incompatible.pdo">
  <h3 class="title">PHP Data Objects</h3>

  <p class="para">
   <strong><code>PDO::ATTR_STRINGIFY_FETCHES</code></strong> now stringifies values
   of type <span class="type">bool</span> to <code class="literal">&quot;0&quot;</code> or
   <code class="literal">&quot;1&quot;</code>. Previously <span class="type">bool</span>s were not stringified.
  </p>
  <p class="para">
   Calling <span class="methodname"><a href="pdostatement.bindcolumn.html" class="methodname">PDOStatement::bindColumn()</a></span> with
   <strong><code>PDO::PARAM_LOB</code></strong> will now constantly bind a stream
   result when <strong><code>PDO::ATTR_STRINGIFY_FETCHES</code></strong> is not enabled.
   Previously, the result would either be a stream or a string depending on
   the used database driver and the time the binding is performed.
  </p>

  <div class="sect3" id="migration81.incompatible.pdo.mysql">
   <h4 class="title">MySQL Driver</h4>

   <p class="para">
    Integers and floats in result sets will now be returned using native
    PHP types instead of <span class="type">string</span>s when using emulated prepared statements.
    This matches the behavior of native prepared statements.
    The previous behaviour can be restored by enabling the
    <strong><code>PDO::ATTR_STRINGIFY_FETCHES</code></strong> option.
   </p>
  </div>

  <div class="sect3" id="migration81.incompatible.pdo.sqlite">
   <h4 class="title">SQLite Driver</h4>

   <p class="para">
    Integers and floats in results sets will now be returned using native
    PHP types.
    The previous behaviour can be restored by enabling the
    <strong><code>PDO::ATTR_STRINGIFY_FETCHES</code></strong> option.
   </p>
  </div>
 </div>

 <div class="sect2" id="migration81.incompatible.phar">
  <h3 class="title">Phar</h3>

  <p class="para">
   To comply with the <span class="interfacename"><a href="class.arrayaccess.html" class="interfacename">ArrayAccess</a></span> interface,
   <span class="methodname"><a href="phar.offsetunset.html" class="methodname">Phar::offsetUnset()</a></span> and
   <span class="methodname"><a href="phardata.offsetunset.html" class="methodname">PharData::offsetUnset()</a></span> no longer return a <span class="type">bool</span>.
  </p>
 </div>

 <div class="sect2" id="migration81.incompatible.standard">
  <h3 class="title">Standard</h3>

  <p class="para">
   <span class="function"><a href="function.version-compare.html" class="function">version_compare()</a></span> no longer accepts undocumented operator abbreviations.
  </p>

  <p class="para">
   <span class="function"><a href="function.htmlspecialchars.html" class="function">htmlspecialchars()</a></span>,
   <span class="function"><a href="function.htmlentities.html" class="function">htmlentities()</a></span>,
   <span class="function"><a href="function.htmlspecialchars-decode.html" class="function">htmlspecialchars_decode()</a></span>,
   <span class="function"><a href="function.html-entity-decode.html" class="function">html_entity_decode()</a></span>,
   and <span class="function"><a href="function.get-html-translation-table.html" class="function">get_html_translation_table()</a></span>
   now use <code class="literal">ENT_QUOTES | ENT_SUBSTITUTE</code> rather than
   <strong><code>ENT_COMPAT</code></strong> by default.
   This means that <code class="literal">&#039;</code> is escaped to
   <code class="literal">&amp;#039;</code> while previously nothing was done.
   Additionally, malformed UTF-8 will be replaced by a Unicode substitution
   character, instead of resulting in an empty string.
  </p>

  <p class="para">
   <span class="function"><a href="function.debug-zval-dump.html" class="function">debug_zval_dump()</a></span> now prints the refcount of a reference
   wrappers with their refcount, instead of only prepending
   <code class="literal">&amp;</code> to the value.
   This more accurately models reference representation since PHP 7.0.
  </p>

  <p class="para">
   <span class="function"><a href="function.debug-zval-dump.html" class="function">debug_zval_dump()</a></span> now prints <code class="literal">interned</code>
   instead of a dummy refcount for interned strings and immutable arrays.
  </p>
 </div>

 <div class="sect2" id="migration81.incompatible.spl">
  <h3 class="title">Standard PHP Library (SPL)</h3>

  <p class="para">
   <span class="classname"><a href="class.splfixedarray.html" class="classname">SplFixedArray</a></span>, will now be JSON encoded like an <span class="type">array</span>
  </p>
 </div>

</div></div></div></body></html>